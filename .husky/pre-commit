#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Check for missing tests
echo "\nğŸ“‹ Checking for files without tests..."
tsx scripts/auto-coverage-detector.ts

if [ $? -ne 0 ]; then
  echo "\nâŒ Some files are missing tests!"
  echo "   Run: npm run generate:test-stubs"
  echo "   Or add tests manually before committing"
  # Don't block commit in development, just warn
  # exit 1
fi

# Run type check
echo "\nğŸ” Running TypeScript type check..."
npm run check

if [ $? -ne 0 ]; then
  echo "\nâŒ Type check failed!"
  exit 1
fi

# Run linter (if configured)
# echo "\nğŸ” Running linter..."
# npm run lint

# Run affected tests only (fast)
echo "\nğŸ§ª Running affected tests..."
# npm run test:affected

echo "\nâœ… Pre-commit checks passed!"
